---
layout: "@/layouts/block-docs-layout.astro"
title: IV_SWEEP
---

{/* DO NOT EDIT THIS FILE! IT IS BEING AUTO GENERATED */}
{/* PLEASE REFER TO THE CONTRIBUTION GUIDE ON THE DOCS PAGE */}

import docstring from "@blocks/IO/INSTRUMENTS/SOURCEMETERS/KEITHLEY/24XX/BASIC/IV_SWEEP/docstring.json";
import PythonDocsDisplay from "@/components/python-docs-display.astro";

<PythonDocsDisplay docstring={docstring} />

<details>
<summary>Python Code</summary>

```python
import serial
import numpy as np
from flojoy import SerialConnection, flojoy, OrderedPair, Vector
from typing import cast


@flojoy(deps={"pyserial": "3.5"}, inject_connection=True)
def IV_SWEEP(
    connection: SerialConnection, default: OrderedPair | Vector
) -> OrderedPair:
    """The IV_SWEEP node takes an I-V curve measurement with a Keithley 2400 source meter, send voltages, and measures currents.

    Inputs
    ------
    default: OrderedPair | Vector
        The voltages to send to the Keithley 2400 source meter.

    Parameters
    ----------
    connection: Serial
        The open connection with the Keithley2400 source meter.

    Returns
    -------
    OrderedPair
    """

    # Start serial communication with the instrument
    ser = cast(serial.Serial, connection.get_handle())

    if ser is None:
        raise ValueError("Serial communication is not open")

    # Keithley 2400 Configuration
    ser.write(b"*RST\n")  # reinitialisation of the instrument
    ser.write(
        b":SOUR:FUNC:MODE VOLT\n"
    )  # Sourcing tension ser.write(b':SENS:FUNC "CURR"\n')  # Measuring current
    ser.write(
        b":SENS:CURR:PROT 1.05\n"
    )  # Current protection set at 1.05A (Keithley 2400)

    match default:
        case OrderedPair():
            voltages = default.y
        case Vector():
            voltages = default.v

    currents_neg: list[float] = []  # measured currents

    for voltage in voltages:
        ser.write(b":SOUR:VOLT %f\n" % voltage)  # Source Tension (V)
        ser.write(b":OUTP ON\n")  # Instrument output open
        ser.write(b":INIT\n")  # Start measuring
        ser.write(b":FETC?\n")  # Retrieve the measured values

        current_str = ser.readline().decode("ascii").strip()  # Save answers in a string
        voltage_current_values = current_str.split(",")  # Split the string
        currents_neg.append(-float(voltage_current_values[1]))

        ser.write(b":OUTP OFF\n")  # Close output from Instrument

    # Close Serial Communication
    ser.close()

    return OrderedPair(x=voltages, y=np.array(currents_neg))

```

[Find this Flojoy Block on GitHub](https://github.com/flojoy-ai/blocks/blob/main/blocks/IO/INSTRUMENTS/SOURCEMETERS/KEITHLEY/24XX/BASIC/IV_SWEEP/IV_SWEEP.py)

</details>

## Example

import GetHelpWidget from "@/components/get-help-widget.astro";

<GetHelpWidget />

import app from "@blocks/IO/INSTRUMENTS/SOURCEMETERS/KEITHLEY/24XX/BASIC/IV_SWEEP/app.json";
import AppDisplay from "@/components/app-display.tsx";

<AppDisplay app={app} blockName="IV_SWEEP" client:visible />

import Example from "@blocks/IO/INSTRUMENTS/SOURCEMETERS/KEITHLEY/24XX/BASIC/IV_SWEEP/example.md";

<Example />

{/* DO NOT EDIT THIS FILE! IT IS BEING AUTO GENERATED */}
{/* PLEASE REFER TO THE CONTRIBUTION GUIDE ON THE DOCS PAGE */}
